{% extends 'site_base.html' %}

{% block page-subtitle %} | {{ page.volume.title }}
   {% if page.volume.volume %} [{{ page.volume.volume }}] | Page {{ page.page_order }}{% endif %}{% endblock %}

{% block javascript %}
  {{ block.super }}
  <script type="text/javascript" src="{{ STATIC_URL }}js/openseadragon/openseadragon.min.js"></script>
  <script type="text/javascript" charset="utf-8">
     $(document).ready(function () {
        // set up seadragon configuration, but don't load unless triggered by user
        var viewer = null;
        var seadragon_opts = {
            id: "zoom-page",
            prefixUrl: "{{ STATIC_URL }}js/openseadragon/images/",
            tileSources: "{% url 'deepzoom:dzi' page.pid %}",
            toolbar: 'deepzoom-controls',
            showNavigator: true,
            navigatorPosition: 'TOP_LEFT',
            zoomInButton: 'dz-zoom-in',
            zoomOutButton: 'dz-zoom-out',
            homeButton: 'dz-home',
            fullPageButton: 'dz-fs',
        };

        /* enable-zoom button toggles deep-zoom page view mode */
        $("#enable-zoom").click(function(){

            if (viewer == null) {   // init viewer first time
              viewer = OpenSeadragon(seadragon_opts);
              console.log('init seadragon viewer');
            }
            $('#zoom-page').css('z-index', 1); // move in front of page image
            $("#deepzoom-controls").toggleClass('hidden'); // show the controls

            // use not-visible class to set image opacity, but leave it visible
            // to the browser because we need it for the page size/layout
            $('#page-image').toggleClass('not-visible');
        });
     });
  </script>
{% endblock %}


{% block content %}
<header class="page-header">
    <div class="container">
        {# TODO: snippet (volume, pages, page) #}
        <h1>
            <a href="{% url 'books:volume' page.volume.pid %}">{{ page.volume.title }}{% if page.volume.volume %} <span class="small">[{{ page.volume.volume }}]</span>{% endif %}</a>
        </h1>
        <p class="lead">
            {% if page.volume.date %}({{ page.volume.date|join:', ' }}){% endif %}
        </p>


    </div>
</header>
    <article class="carousel page">
        <div class="carousel-inner">

            <div class="container">
                <div id="view-toggle" class="pull-right">
                    <div class="btn-group">
                        <a id="enable-zoom" href="#" class="btn"><span class="glyphicon glyphicon-fullscreen"></span></a>

                        <a id="covers" href="#" class="btn active"><span class="glyphicon glyphicon-file"></span></a>

                        <a id="list" href="{% url 'books:pages' page.volume.pid %}?page={{page_chunk}}" class="btn"><span class="glyphicon glyphicon-th"></span></a>
                    </div>
                    <br/>
                    <div id="deepzoom-controls" class="hidden">
                        <div class="btn-group">
                            <a id="dz-zoom-in" href="#" class="btn"><span class="glyphicon glyphicon-plus"></span></a>
                            <a id="dz-zoom-out" href="#" class="btn"><span class="glyphicon glyphicon-minus"></span></a>
                            <a id="dz-home" href="#" class="btn"><span class="glyphicon glyphicon-home"></span></a>
                            <a id="dz-fs" href="#" class="btn"><span class="glyphicon glyphicon-fullscreen"></span></a>
                        </div>
                    </div>
                </div>

            </div>

            <div class="text-center">
                <p class="text-muted">Page {{page.page_order}}</p>
                <div id="zoom-page"></div>
                <div id="page-image"><img src="{% url 'books:page-image' page.pid %}"/></div>
            </div>
        </div>

        {% if prev %}
        <a class="left carousel-control" href="{% url 'books:page' prev.pid %}" role="button" data-slide="prev" title="Prev: Page {{ prev.page_order }}">
            <span class="glyphicon glyphicon-chevron-left"></span>
        </a>
        {% endif %}
        {% if next %}
        <a class="right carousel-control" href="{% url 'books:page' next.pid %}" role="button" data-slide="next" title="Next: Page {{ next.page_order }}">
            <span class="glyphicon glyphicon-chevron-right"></span>
        </a>
        {% endif %}
    </article>
</div>
{% endblock %}
