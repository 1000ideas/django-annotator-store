{% comment %} Header for single volume pages: volume landing page, multi-page view, single page view, search results
Expects volume object as vol; set rdfa to true to enable RDFa properties.
{% endcomment %}
{% load widget_tweaks %}
<header class="page-header">
    <h1>
        {% url 'books:volume' vol.pid as volume_url %}
        {# only link to volume landing page if we are not currently *on* that page #}
        {% if volume_url != request.get_full_path|urlencode %}
          <a href="{{ volume_url }}">
        {% endif %}
            <span {% if rdfa|default:0 %}property="schema:name"{% endif %}>
                {% if volume_url != request.get_full_path|urlencode %}
                    {{ vol.title }}
                {% else %}
                    {{ vol.title|slice:":150"}}
                    {% if vol.title|length > 150 %}
                        <span class="expand"></span>
                        <span class="continued">
                            {{ vol.title|slice:"150:"}}
                        </span>
                    {% endif %}
                {% endif %}
                {% if vol.volume %}<span class="small">[{{ vol.volume }}]</span>{% endif %}
                {# NOTE: including volume in title since there isn't another obvious schema.org field to use #}
        </span>
        {% if url != request.get_full_path %}</a>{% endif %} {# end volume link #}
    </h1>
    <p class="lead">
        {% for d in vol.date %} {# NOTE: assuming earliest date we have is publication date...  #}
        (<span {% if rdfa|default:0 %}property="schema:datePublished"{% endif %}>{{ d }}</span>){% if not forloop.last %}; {% endif %}
        {# FIXME: or should we use schema:copyrightYear? #}
        {% endfor %}
    </p>

    {# search inside this volume; *only* available if volume has pages loaded #}
    {% if vol.has_pages and form %}
      <div class="row">
        <div class="col-xs-12 col-md-8 col-md-offset-2">
          <form id="volume-search" class="search-bar" role="form" method="GET" action="{{ volume_url }}">
            <label class="sr-only" for="{{ form.keyword.name }}">{{ form.keyword.label }}</label>
            <div class="input-group">
              {% render_field form.keyword class+="form-control keyword" placeholder="Search in this volume" %}
              <span class="input-group-btn">
                <button class="btn" type="submit"><span class="glyphicon glyphicon-search"></span></button>
              </span>
            </div><!-- /input-group -->
          </form>
        </div>
      </div>
    {% endif %}

</header>
